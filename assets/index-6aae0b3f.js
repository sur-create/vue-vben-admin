var je=Object.defineProperty,Ve=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var ie=(e,l,n)=>l in e?je(e,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[l]=n,O=(e,l)=>{for(var n in l||(l={}))Xe.call(l,n)&&ie(e,n,l[n]);if(re)for(var n of re(l))Ye.call(l,n)&&ie(e,n,l[n]);return e},ue=(e,l)=>Ve(e,He(l));var oe=(e,l,n)=>new Promise((k,_)=>{var A=L=>{try{p(n.next(L))}catch(b){_(b)}},s=L=>{try{p(n.throw(L))}catch(b){_(b)}},p=L=>L.done?k(L.value):Promise.resolve(L.value).then(A,s);p((n=n.apply(e,l)).next())});import{an as Re,d as Ee,f as Te,ag as ze,c as M,w as P,Z as I,_ as $,u,N as qe,ab as m,a8 as J,a9 as j,E as de,a0 as he,a1 as fe,l as C,F as z,aa as We,ai as Ge,aj as Je,A as Qe,m as ye,r as pe,H as R,h as V,o as Ze,n as ke,z as ge,ac as et,i as tt}from"./vue-ea98dac5.js";import{aF as nt,k as at,u as lt,a8 as ct,I as Z,aG as Se,N as st,m as Q,aH as rt,ac as it,aI as ut,a6 as Ke,a2 as ot,W as dt,S as xe,x as Ce}from"./index.js";import{aP as ht,aQ as ft,aR as yt,q as pt,aS as kt,aT as gt,D as St,aU as Kt,e as ee,aV as xt,o as Ct,y as At,ae as Lt,ax as Ae,a7 as vt}from"./antd-4273b3e7.js";import{u as bt}from"./useContextMenu-a082ef9b.js";function te(e,l){return l?typeof l=="string"?` ${e}--${l}`:Array.isArray(l)?l.reduce((n,k)=>n+te(e,k),""):Object.keys(l).reduce((n,k)=>n+(l[k]?te(e,k):""),""):""}function Et(e){return(l,n)=>(l&&typeof l!="string"&&(n=l,l=""),l=l?`${e}__${l}`:e,`${l}${te(l,n)}`)}function _e(e){return[Et(`${nt}-${e}`)]}const Le=Symbol(),ve=Symbol();function Tt(e,l){if(!ft(e)||e[ve])return e;const{values:n,required:k,default:_,type:A,validator:s}=e,p=n||s?L=>{let b=!1,v=[];if(n&&(v=[...n,_],b||(b=v.includes(L))),s&&(b||(b=s(L))),!b&&v.length>0){const h=[...new Set(v)].map(t=>JSON.stringify(t)).join(", ");Re(`Invalid prop: validation failed${l?` for prop "${l}"`:""}. Expected one of [${h}], got value ${JSON.stringify(L)}.`)}return b}:void 0;return{type:typeof A=="object"&&Object.getOwnPropertySymbols(A).includes(Le)&&A?A[Le]:A,required:!!k,default:_,validator:p,[ve]:!0}}const _t=e=>ht(Object.entries(e).map(([l,n])=>[l,Tt(n,l)]));var T=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(T||{});const Bt=["update:expandedKeys","update:selectedKeys","update:value","change","check","update:searchValue"],wt=_t({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:[Array,Object],default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1},treeWrapperClassName:String}),Ft={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch"},Dt=Ee({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search"],setup(e,{emit:l}){const n=e,k=Te(""),[_]=_e("tree-header"),A=ze(),{t:s}=at(),p=M(()=>["mr-1","w-full",{"ml-5":A.headerTitle||n.title}]),L=M(()=>{const{checkable:t}=n,c=[{label:s("component.tree.expandAll"),value:T.EXPAND_ALL},{label:s("component.tree.unExpandAll"),value:T.UN_EXPAND_ALL,divider:t}];return t?[{label:s("component.tree.selectAll"),value:T.SELECT_ALL},{label:s("component.tree.unSelectAll"),value:T.UN_SELECT_ALL,divider:t},...c,{label:s("component.tree.checkStrictly"),value:T.CHECK_STRICTLY},{label:s("component.tree.checkUnStrictly"),value:T.CHECK_UN_STRICTLY}]:c}),b=({key:t})=>{var c,r,d,o;switch(t){case T.SELECT_ALL:(c=n.checkAll)==null||c.call(n,!0);break;case T.UN_SELECT_ALL:(r=n.checkAll)==null||r.call(n,!1);break;case T.EXPAND_ALL:(d=n.expandAll)==null||d.call(n,!0);break;case T.UN_EXPAND_ALL:(o=n.expandAll)==null||o.call(n,!1);break;case T.CHECK_STRICTLY:l("strictly-change",!1);break;case T.CHECK_UN_STRICTLY:l("strictly-change",!0);break}};function v(t){l("search",t)}const h=lt(v,200);return P(()=>k.value,t=>{h(t)}),P(()=>n.searchText,t=>{t!==k.value&&(k.value=t)}),(t,c)=>(I(),$("div",{class:fe([u(_)(),"flex px-2 py-1.5 items-center"])},[u(A).headerTitle?qe(t.$slots,"headerTitle",{key:0}):m("",!0),!u(A).headerTitle&&t.title?(I(),J(u(ct),{key:1,helpMessage:t.helpMessage},{default:j(()=>[de(he(t.title),1)]),_:1},8,["helpMessage"])):m("",!0),t.search||t.toolbar?(I(),$("div",Ft,[t.search?(I(),$("div",{key:0,class:fe(p.value)},[C(u(yt),{placeholder:u(s)("common.searchText"),size:"small",allowClear:"",value:k.value,"onUpdate:value":c[0]||(c[0]=r=>k.value=r)},null,8,["placeholder","value"])],2)):m("",!0),t.toolbar?(I(),J(u(St),{key:1,onClick:c[1]||(c[1]=Qe(()=>{},["prevent"]))},{overlay:j(()=>[C(u(pt),{onClick:b},{default:j(()=>[(I(!0),$(z,null,We(L.value,r=>(I(),$(z,{key:r.value},[C(u(kt),Ge(Je({key:r.value})),{default:j(()=>[de(he(r.label),1)]),_:2},1040),r.divider?(I(),J(u(gt),{key:0})):m("",!0)],64))),128))]),_:1})]),default:j(()=>[C(Z,{icon:"ion:ellipsis-vertical"})]),_:1})):m("",!0)])):m("",!0)],2))}}),Nt=({icon:e})=>e?Kt(e)?ye(Z,{icon:e,class:"mr-1"}):ye(Z):null;function It(e,l){function n(h){const t=[],c=h||u(e),{key:r,children:d}=u(l);if(!d||!r)return t;for(let o=0;o<c.length;o++){const i=c[o];t.push(i[r]);const y=i[d];y&&y.length&&t.push(...n(y))}return t}function k(h){const t=[],c=h||u(e),{key:r,children:d}=u(l);if(!d||!r)return t;for(let o=0;o<c.length;o++){const i=c[o];i.disabled!==!0&&i.selectable!==!1&&t.push(i[r]);const y=i[d];y&&y.length&&t.push(...k(y))}return t}function _(h,t){const c=[],r=t||u(e),{key:d,children:o}=u(l);if(!o||!d)return c;for(let i=0;i<r.length;i++){const y=r[i],E=y[o];h===y[d]?(c.push(y[d]),E&&E.length&&c.push(...n(E))):E&&E.length&&c.push(..._(h,E))}return c}function A(h,t,c){if(!h)return;const r=c||u(e),{key:d,children:o}=u(l);if(!(!o||!d))for(let i=0;i<r.length;i++){const y=r[i],E=y[o];if(y[d]===h){r[i]=O(O({},r[i]),t);break}else E&&E.length&&A(h,t,y[o])}}function s(h=1,t,c=1){if(!h)return[];const r=[],d=t||u(e)||[];for(let o=0;o<d.length;o++){const i=d[o],{key:y,children:E}=u(l),q=y?i[y]:"",U=E?i[E]:[];r.push(q),U&&U.length&&c<h&&(c+=1,r.push(...s(h,U,c)))}return r}function p({parentKey:h=null,node:t,push:c="push"}){const r=ee(u(e));if(!h){r[c](t),e.value=r;return}const{key:d,children:o}=u(l);!o||!d||(Se(r,i=>{if(i[d]===h)return i[o]=i[o]||[],i[o][c](t),!0}),e.value=r)}function L({parentKey:h=null,list:t,push:c="push"}){const r=ee(u(e));if(!(!t||t.length<1))if(h){const{key:d,children:o}=u(l);if(!o||!d)return;Se(r,i=>{if(i[d]===h){i[o]=i[o]||[];for(let y=0;y<t.length;y++)i[o][c](t[y]);return e.value=r,!0}})}else{for(let d=0;d<t.length;d++)r[c](t[d]);e.value=r;return}}function b(h,t){if(!h)return;const c=t||u(e),{key:r,children:d}=u(l);if(!(!d||!r))for(let o=0;o<c.length;o++){const i=c[o],y=i[d];if(i[r]===h){c.splice(o,1);break}else y&&y.length&&b(h,i[d])}}function v(h,t,c){if(!h&&h!==0)return null;const r=t||u(e),{key:d,children:o}=u(l);return d?(r.forEach(i=>{if(c!=null&&c.key||(c==null?void 0:c.key)===0)return c;if(i[d]===h){c=i;return}i[o]&&i[o].length&&(c=v(h,i[o],c))}),c||null):null}return{deleteNodeByKey:b,insertNodeByKey:p,insertNodesByKey:L,filterByLevel:s,updateNodeByKey:A,getAllKeys:n,getChildrenKeys:_,getEnabledKeys:k,getSelectedNode:v}}function be(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!tt(e)}const $t=Ee({name:"BasicTree",inheritAttrs:!1,props:wt,emits:Bt,setup(e,{attrs:l,slots:n,emit:k,expose:_}){const[A]=_e("tree"),s=pe({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),p=pe({startSearch:!1,searchText:"",searchData:[]}),L=Te([]),[b]=bt(),v=M(()=>{const{fieldNames:a}=e;return O({children:"children",title:"title",key:"key"},a)}),h=M(()=>{let a=ue(O(O({blockNode:!0},l),e),{expandedKeys:s.expandedKeys,selectedKeys:s.selectedKeys,checkedKeys:s.checkedKeys,checkStrictly:s.checkStrictly,fieldNames:u(v),"onUpdate:expandedKeys":f=>{s.expandedKeys=f,k("update:expandedKeys",f)},"onUpdate:selectedKeys":f=>{s.selectedKeys=f,k("update:selectedKeys",f)},onCheck:(f,S)=>{let g=R(s.checkedKeys);if(st(g)&&p.startSearch){const x=S.node.eventKey;g=xt(g,q(x)),S.checked&&g.push(x),s.checkedKeys=g}else s.checkedKeys=f;const K=R(s.checkedKeys);k("update:value",K),k("check",K,S)},onRightClick:Fe});return Ct(a,"treeData","class")}),t=M(()=>p.startSearch?p.searchData:u(L)),c=M(()=>!t.value||t.value.length===0),{deleteNodeByKey:r,insertNodeByKey:d,insertNodesByKey:o,filterByLevel:i,updateNodeByKey:y,getAllKeys:E,getChildrenKeys:q,getEnabledKeys:U,getSelectedNode:Be}=It(L,v);function we(a,f){return!f&&e.renderIcon&&Q(e.renderIcon)?e.renderIcon(a):f}function Fe(S){return oe(this,arguments,function*({event:a,node:f}){var D;const{rightMenuList:g=[],beforeRightClick:K}=e;let x={event:a,items:[]};if(K&&Q(K)){let B=yield K(f,a);Array.isArray(B)?x.items=B:Object.assign(x,B)}else x.items=g;(D=x.items)!=null&&D.length&&(x.items=x.items.filter(B=>!B.hidden),b(x))})}function H(a){s.expandedKeys=a}function De(){return s.expandedKeys}function ne(a){s.selectedKeys=a}function Ne(){return s.selectedKeys}function ae(a){s.checkedKeys=a}function Ie(){return s.checkedKeys}function le(a){s.checkedKeys=a?U():[]}function W(a){s.expandedKeys=a?E():[]}function Me(a){s.checkStrictly=a}P(()=>e.searchValue,a=>{a!==p.searchText&&(p.searchText=a)},{immediate:!0}),P(()=>e.treeData,a=>{a&&G(p.searchText)});function G(a){if(a!==p.searchText&&(p.searchText=a),k("update:searchValue",a),!a){p.startSearch=!1;return}const{filterFn:f,checkable:S,expandOnSearch:g,checkOnSearch:K,selectedOnSearch:x}=u(e);p.startSearch=!0;const{title:D,key:B}=u(v),F=[];if(p.searchData=rt(u(L),w=>{var X,Y;const N=f?f(a,w,u(v)):(Y=(X=w[D])==null?void 0:X.includes(a))!=null?Y:!1;return N&&F.push(w[B]),N},u(v)),g){const w=it(p.searchData).map(N=>N[B]);w&&w.length&&H(w)}K&&S&&F.length&&ae(F),x&&F.length&&ne(F)}function Oe(a,f){if(!(!e.clickRowToExpand||!f||f.length===0))if(!s.expandedKeys.includes(a))H([...s.expandedKeys,a]);else{const S=[...s.expandedKeys],g=S.findIndex(K=>K===a);g!==-1&&S.splice(g,1),H(S)}}V(()=>{L.value=e.treeData}),Ze(()=>{const a=parseInt(e.defaultExpandLevel);a>0?s.expandedKeys=i(a):e.defaultExpandAll&&W(!0)}),V(()=>{s.expandedKeys=e.expandedKeys}),V(()=>{s.selectedKeys=e.selectedKeys}),V(()=>{s.checkedKeys=e.checkedKeys}),P(()=>e.value,()=>{s.checkedKeys=R(e.value||[])},{immediate:!0}),P(()=>s.checkedKeys,()=>{const a=R(s.checkedKeys);k("update:value",a),k("change",a)}),V(()=>{s.checkStrictly=e.checkStrictly});const me={setExpandedKeys:H,getExpandedKeys:De,setSelectedKeys:ne,getSelectedKeys:Ne,setCheckedKeys:ae,getCheckedKeys:Ie,insertNodeByKey:d,insertNodesByKey:o,deleteNodeByKey:r,updateNodeByKey:y,getSelectedNode:Be,checkAll:le,expandAll:W,filterByLevel:a=>{s.expandedKeys=i(a)},setSearchValue:a=>{G(a)},getSearchValue:()=>p.searchText};function Pe(a){const{actionList:f}=e;if(!(!f||f.length===0))return f.map((S,g)=>{var x;let K=!0;return Q(S.show)?K=(x=S.show)==null?void 0:x.call(S,a):xe(S.show)&&(K=S.show),K?C("span",{key:g,class:A("action")},[S.render(a)]):null})}const Ue=M(()=>{const a=ee(t.value);return ut(a,(f,S)=>{var se;const g=p.searchText,{highlight:K}=u(e),{title:x,key:D,children:B}=u(v),F=we(f,f.icon),w=vt(f,x),N=g?w.indexOf(g):-1,X=p.startSearch&&!dt(g)&&K&&N!==-1,Y=`color: ${xe(K)?"#f50":K}`,$e=X?C("span",{class:(se=u(h))!=null&&se.blockNode?`${A("content")}`:""},[C("span",null,[w.substr(0,N)]),C("span",{style:Y},[g]),C("span",null,[w.substr(N+g.length)])]):w,ce=F?C(Nt,{icon:F},null):n.icon?C("span",{class:"mr-1"},[Ce(n,"icon")]):null;return f[x]=C("span",{class:`${A("title")} pl-2`,onClick:Oe.bind(null,f[D],f[B])},[n!=null&&n.title?C(z,null,[ce,Ce(n,"title",f)]):C(z,null,[ce,$e,C("span",{class:A("actions")},[Pe(f)])])]),f}),a});return _(me),()=>{let a,f;const{title:S,helpMessage:g,toolbar:K,search:x,checkable:D}=e,B=S||K||x||n.headerTitle,F={height:"calc(100% - 38px)"};return C("div",{class:[A(),"h-full",l.class]},[B&&C(Dt,{checkable:D,checkAll:le,expandAll:W,title:S,search:x,toolbar:K,helpMessage:g,onStrictlyChange:Me,onSearch:G,searchText:p.searchText},be(a=Ke(n))?a:{default:()=>[a]}),C(At,{wrapperClassName:u(e.treeWrapperClassName),spinning:u(e.loading),tip:"加载中..."},{default:()=>[ke(C(ot,{style:F},{default:()=>[C(Lt,et(u(h),{showIcon:!1,treeData:Ue.value}),be(f=Ke(n,["title"]))?f:{default:()=>[f]})]}),[[ge,!u(c)]]),ke(C(Ae,{image:Ae.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[ge,u(c)]])]})])}}});export{$t as _};
